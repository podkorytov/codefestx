<loader
  [isReady]="isReady">

  <layout
    [title]="title"
    [state]="state">

    <!-- Actions -->
    <layout-actions
      actions
      [searchText]="searchText"
      [isSearchMode]="isSearchMode"
      (onSearch)="onSearch($event)"
      (onSearchModeChange)="onSearchModeChange($event)">
    </layout-actions>

    <!-- Tags -->
    <nav
      pre-content
      *ngIf="!isSearchMode"
      class="tags">

      <!-- Buttons group -->
      <div
        [class.buttons-group--selected]="isAllSelected"
        class="tags__item buttons-group">

        <!-- Filters -->
        <button
          cf-button
          (click)="onFilter()"
          class="button-tag button-icon-only">

          <svg
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="24" height="24" viewBox="0 0 24 24"
            class="button-icon">
            <path d="M5 6h14a1 1 0 0 1 0 2H5a1 1 0 1 1 0-2zm3 5h8a1 1 0 0 1 0 2H8a1 1 0 0 1 0-2zm3 5h2a1 1 0 0 1 0 2h-2a1 1 0 0 1 0-2z" fill-rule="evenodd"/>
          </svg>
        </button>

        <!-- All -->
        <button
          cf-button
          (click)="onShowAllClick()"
          class="button-tag">
          {{ filterTitle }}
        </button>
      </div>

      <button
        cf-button
        (click)="onShowFavoriteClick()"
        [class.button-primary]="isFavoriteSelected"
        class="tags__item button-tag">
        Избранные
      </button>

      <button
        cf-button
        *ngIf="false"
        (click)="onShowNowClick()"
        [class.button-primary]="isNowSelected"
        class="tags__item button-tag">
        Идет сейчас
      </button>

      <button
        cf-button
        (click)="onShowCustomClick()"
        [class.button-primary]="isCustomSelected"
        class="tags__item button-tag">
        Движухи
      </button>
    </nav>

    <!-- Content -->
    <div
      content>

      <!-- Schedule -->
      <favorite-empty-state
        *ngIf="lectures.isEmpty && isFavoriteSelected">
      </favorite-empty-state>

      <div
        class="schedule">

        <section
          *ngFor="let groupedTime of groupedLectures; let i = index"
          class="schedule__section-day">

          <div>
            {{ getDay(groupedTime) }}
          </div>

          <section
            *ngFor="let lectures of groupedTime"
            class="schedule__section-time">

            <template
              ngFor let-lecture [ngForOf]="lectures" let-i="index">

              <div
                class="schedule__event event">

                <!-- Time -->
                <div
                  class="event__time">

                  <template
                    [ngIf]="i == 0">

                    <!-- Start -->
                    <time
                      class="event__time-item event__time-item--start"
                      [class.right_now]="isRightNow(lecture)"
                      [class.finished]="isFinished(lecture)">
                      {{ startTime(lecture) }}
                    </time>

                    <!-- End -->
                    <time
                      class="event__time-item">
                      {{ endTime(lecture) }}
                    </time>
                  </template>
                </div>

                <!-- Info (todo details)-->
                <article
                  (click)="onLectureSelect(lecture)"
                  class="event__info event-card">

                  <!-- Meta -->
                  <div
                    class="event-card__meta">

                    <!-- Location -->
                    <span
                      class="event-card__meta-item">
                      {{ lecture.location.title }}
                    </span>

                    &ngsp;•&ngsp;

                    <!-- Section -->
                    <span
                      class="event-card__meta-item"
                      [style.color]="lecture.section.color">
                      {{ lecture.section.title }}
                    </span>

                    <!--{{ flag(lecture) }}-->
                  </div>

                  <!-- Title -->
                  <h1
                    class="event-card__title">
                    {{ lecture.title }}
                  </h1>

                  <!-- Speakers (todo: info item) -->
                  <div
                    class="event-card__speakers info-item">

                    <!-- Media -->
                    <div
                      class="info-item__media">

                <span
                  *ngFor="let speaker of lecture.speakers"
                  class="info-item__media-container">

                  <img
                    [src]="speaker.avatarPath"
                    [alt]="speaker.name"
                    class="info-item__media-image">
                </span>
                    </div>

                    <!-- Details -->
                    <div
                      class="info-item__details">

                      <!-- Title -->
                      <div
                        class="info-item__title">

                        <ng-container
                          *ngFor="let speaker of lecture.speakers">
                          {{ speaker.name }}
                        </ng-container>
                      </div>

                      <!-- Subtitle -->
                      <div
                        class="info-item__subtitle">

                        <ng-container
                          *ngFor="let speaker of lecture.speakers">
                          {{ speaker.company }}
                        </ng-container>
                      </div>
                    </div>
                  </div>

                  <ng-container
                    *ngFor="let speaker of lecture.speakers; let i = index">

                    <div
                      *ngIf="lecture.speakers.length == i + 1"
                      class="event-card__actions">

                      <actions
                        [popularity]="lecture.likesCount"
                        [isFavorite]="isFavoriteLecture(lecture)"
                        (onFavoriteChange)="onFavoriteChange(lecture, $event)">
                      </actions>
                    </div>
                  </ng-container>
                </article>
              </div>
            </template>
          </section>
        </section>
      </div>
    </div>
  </layout>
</loader>
